<form class="form-horizontal">
  <div class="form-group row">
    <div class="col-sm-4">
      <label for="cta-cte-proveedor" class="col-sm-4 control-label" id="proveedor-label">Proveedor:</label>
      <div class="col-sm-8 input-group" [ngClass]="{'has-error': (!nombre.valid && (!nombre.pristine || nombre.touched || submitted))
      || typeaheadNoResults===true
      || (proveedorCtaCteAsync.length < 3 && proveedorCtaCteAsync.length > 0)}">
        <input id="cta-cte-proveedor" [(ngModel)]="proveedorCtaCteAsync" name="proveedorCtaCteAsync"
               [typeahead]="proveedoresCtaCte"
               (typeaheadOnSelect)="onProveedorCtaCteChanged($event.item)"
               (typeaheadNoResults)="changeTypeaheadNoResults($event)"
               (typeaheadOnBlur)="typeaheadOnBlur()"
               typeaheadMinLength="3"
               typeaheadOptionsLimit="7"
               typeaheadOptionField="nombre"
               class="form-control"
               autocomplete="off"
               placeholder="Proveedor"
               #nombre="ngModel"
               required
               #typeaheadNombreProveedor>
        <div *ngIf="!nombre.valid && (!nombre.pristine || nombre.touched || submitted)" class="help-block">Ingrese un nombre</div>
        <div *ngIf="typeaheadNoResults === true" class="help-block">No se han encontrado resultados</div>
        <div *ngIf="(proveedorCtaCteAsync.length < 3 && proveedorCtaCteAsync.length > 0)" class="help-block">Ingrese 3 letras para comenzar la búsqueda</div>
      </div>
    </div>

    <div class="col-sm-6">
      <div class="radio">
        <label><input type="radio" [(ngModel)]="fechaSeleccionadaCtaCte" name="fechaSeleccionadaCtaCte" [value]="false" >Todos los movimientos</label>
      </div>
      <div class="radio" [ngClass]="{'has-error': rangoFechaInvalido() && fechaSeleccionadaCtaCte}">
        <div class="col-sm-3" style="padding-left: 0; padding-right: 0; padding-top: 8px">
          <label>
            <input type="radio" [(ngModel)]="fechaSeleccionadaCtaCte" name="fechaSeleccionadaCtaCte" [value]="true">
            Solo el intervalo:
          </label>
        </div>

        <div [hidden]="!fechaSeleccionadaCtaCte" class="col-sm-8" style="padding-left: 0; padding-right: 0">
          <div  class="col-sm-5">
            <my-date-picker id="cta-cte-fecha-inicio" [(ngModel)]="fechaInicioCtaCte" [name]="'fecha-inicio'" [options]="myDatePickerOptions"></my-date-picker>
          </div>

          <div class="col-sm-5">
            <my-date-picker id="cta-cte-fecha-fin" [(ngModel)]="fechaFinCtaCte" [name]="'fecha-fin'" [options]="myDatePickerOptions"></my-date-picker>
          </div>
        </div>
        <div *ngIf="(rangoFechaInvalido() && fechaSeleccionadaCtaCte)" class="help-block col-sm-12">La fecha de inicio no puede ser posterior a la fecha de fin</div>
      </div>
    </div>
    <div class="col-sm-2">
      <button class="btn btn-default" (click)="filtrarCtaCte()">Filtrar</button>
    </div>
  </div>
  <table id="table" datatable [dtOptions]="dtOptions" class="row-border hover table" width="100%">
    <thead>
    <tr>
      <th class="text-center" width="15%">Fecha</th>
      <th class="text-center" width="18%">Comprobante</th>
      <th class="text-center" width="12%">Nro.</th>
      <th class="text-center" width="15%">Debe</th>
      <th class="text-center" width="15%">Haber</th>
      <th class="text-center" width="15%">Saldo</th>
      <th class="text-center" width="10%">Acciones</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let reg of registrosCtaCte">
      <td class="text-center" width="15%">{{reg.fecha}}</td>
      <td width="18%">{{reg.tipo_comp_compras.nombre}}</td>
      <td class="text-center" width="12%">{{reg.ptoventaynumero}}</td>
      <td class="text-right" width="15%">$ {{reg.debe | number: '1.2-2'}}</td>
      <td class="text-right" width="15%">$ {{reg.haber | number: '1.2-2'}}</td>
      <td class="text-right" width="15%">$ {{reg.saldo | number: '1.2-2'}}</td>
      <td class="text-center" width="10%">
        <button title="Ver comprobante" data-toggle="modal" data-target="#modalEditar" class="glyphicon glyphicon-eye-open blue" (click)="mostrarModalVer(reg)"></button>
        <!--<button title="Imprimir comprobante" class="glyphicon glyphicon-print blue" (click)="imprimirPDF(reg)"></button >-->
      </td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
      <th width="15%"></th>
      <th width="18%"></th>
      <th width="12%"></th>
      <th width="15%"></th>
      <th class="text-center" width="15%">Saldo Total</th>
      <th class="text-right" width="15%">$ {{saldo | number: '1.2-2'}}</th>
      <th width="10%"></th>
    </tr>
    </tfoot>
  </table>

</form>
<button (click)="imprimirReporteCtaCte()" data-dismiss="modal" class="btn btn-default pull-right">Imprimir</button>

<div class="modal fade" id="modalVer" tabindex="-1" role="dialog" aria-labelledby="modalVer" #modalVer>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" (click)="cerrar()" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
        <h4 class="modal-title">Comprobante Compra</h4>
      </div>
      <form class="form-horizontal" #f="ngForm">
        <div class="modal-body">
<!--          <div class="form-group row">
            <div class="col-sm-12">
              <label for="comprobante-proveedor-nombre" class="col-sm-2 control-label">Proveedor</label>
              <div class="col-sm-3">
                <input class="form-control" name="comprobante-proveedor-nombre" id="comprobante-proveedor-nombre" [ngModel]="comprobante.proveedor_nombre" readonly>
              </div>

              <label for="comprobante-proveedor-tiporesp" class="col-sm-1 control-label">Tipo</label>
              <div class="col-sm-3">
                <input class="form-control" name="comprobante-proveedor-tiporesp" id="comprobante-proveedor-tiporesp" [ngModel]="verComprProveedorTipoResp" readonly>
              </div>

              <label for="comprobante-proveedor-cuit" class="col-sm-1 control-label">CUIT</label>
              <div class="col-sm-2">
                <input class="form-control" name="comprobante-proveedor-cuit" id="comprobante-proveedor-cuit" [ngModel]="comprobante.proveedor_cuit" readonly>
              </div>
            </div>
          </div>-->

          <div class="form-group row">
            <div class="col-sm-12">
              <label for="comprobante-tipo" class="col-sm-2 control-label">Tipo de comprobante</label>
              <div class="col-sm-3">
                <input class="form-control" name="comprobante-tipo" id="comprobante-tipo" [ngModel]="verComprTipo" readonly>
              </div>

              <label for="comprobante-puntoventa" class="col-sm-2 control-label">Punto de venta</label>
              <div class="col-sm-2">
                <input class="form-control" name="comprobante-puntoventa" id="comprobante-puntoventa" [ngModel]="verComprPuntoVenta" readonly>
              </div>

              <label for="comprobante-numero" class="col-sm-1 control-label">Numero</label>
              <div class="col-sm-2">
                <input class="form-control" name="comprobante-numero" id="comprobante-numero" [ngModel]="verComprNumero" readonly>
              </div>
            </div>
          </div>

          <div class="form-group row">
            <div class="col-sm-12">
              <label for="comprobante-periodo" class="col-sm-2 control-label">Periodo</label>
              <div class="col-sm-3">
                <input class="form-control" name="comprobante-periodo" id="comprobante-periodo" [ngModel]="verComprPeriodo" readonly>
              </div>


              <label for="comprobante-fecha" class="col-sm-1 control-label">Fecha</label>
              <div class="col-sm-3">
                <input class="form-control" name="comprobante-fecha" id="comprobante-fecha" [ngModel]="comprobante.fecha | date:'yyyy-MM-dd'"  (ngModelChange)="comprobante.fecha = $event" readonly>
              </div>
            </div>
          </div>

          <!--TODO mostrar otra cosa si es nota de crédito o débito-->
          <div style="height: 150px;overflow-y: auto;" *ngIf="ctaCteProveedorSeleccionada.comprobante_compras_id">
            <table id="tablemodal" class="row-border hover table" >
              <thead>
              <tr>
                <th width="25%" class="text-center">Percepción</th>
                <th width="25%" class="text-center">Base Imponible</th>
                <th width="25%" class="text-center">Alícuota</th>
                <th width="25%" class="text-center">Total</th>
              </tr>
              </thead>
              <tbody>
              <tr>
                <td width="25%" class="text-center">IVA</td>
                <td width="25%" class="text-center">$ {{verCompCCI.importe_neto_gravado | number: '1.2-2'}}</td>
                <td width="25%" class="text-center">{{verCompCCI.alicuota_iva}}%</td>
                <td width="25%" class="text-center">$ {{verCompCCI.importe_iva | number: '1.2-2'}}</td>
              </tr>
              <tr *ngFor="let retencion of verCompRetenciones">
                <td width="25%" class="text-center">{{retencion.tipoRetencion?.nombre}}</td>
                <td width="25%" class="text-center">$ {{retencion.base_imponible | number: '1.2-2'}}</td>
                <td width="25%" class="text-center">{{retencion.alicuota}}%</td>
                <td width="25%" class="text-center">$ {{retencion.importe | number: '1.2-2'}}</td>
              </tr>
              </tbody>
            </table>
          </div>

          <ng-container *ngIf="ctaCteProveedorSeleccionada.orden_pago_id">
            <h4>Valores</h4>
            <div style="height: 110px;overflow-y: auto;" >
              <table id="tablemodalordenpago" class="row-border hover table" >
                <thead>
                <tr>
                  <th class="text-center">Valor</th>
                  <th class="text-center">Número</th>
                  <th class="text-center">Fecha</th>
                  <th class="text-center">Importe</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let item of comprobante.orden_pago_valores">
                  <td class="text-left">{{item.nombre}}</td>
                  <td class="text-center">{{item.numero}}</td>
                  <td class="text-center">{{item.fecha}}</td>
                  <td class="text-right">{{item.importe | number:'1.2-2'}}</td>
                </tr>
                </tbody>
              </table>
            </div>

            <h4>Comprobantes</h4>
            <div style="height: 110px;overflow-y: auto;">
              <table id="tablemodalordenpagoitems" class="row-border hover table" >
                <thead>
                <tr>
                  <th class="text-center">Tipo</th>
                  <th class="text-center">Número</th>
                  <th class="text-center">Fecha</th>
                  <th class="text-center">Importe Pagado</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let item of comprobante.orden_pago_items">
                  <td class="text-left">{{item.anticipo? 'Anticipo' : item.comprobante_compra.tipo_comp_compras.nombre}}</td>
                  <td class="text-center">{{item.anticipo? '' : item.ptoventaynumero}}</td>
                  <td class="text-center">{{item.anticipo? '' : item.comprobante_compra.fecha}}</td>
                  <td class="text-right">{{item.importe_total | number:'1.2-2'}}</td>
                </tr>
                </tbody>
              </table>
            </div>
          </ng-container>

          <div class="form-group row" [hidden]="!regexTipoA.test(comprobante.tipo_comp_compras.codigo)">
            <label for="comprobante-subtotal" class="col-sm-2  col-sm-offset-8 control-label">Subtotal</label>
            <div class="col-sm-2">
              <input class="form-control ver-total" type="number" name="comprobante-subtotal" id="comprobante-subtotal" [ngModel]="verCompCCI.importe_neto_gravado" readonly>
            </div>
          </div>
          <div class="form-group row" [hidden]="!regexTipoA.test(comprobante.tipo_comp_compras.codigo)">
            <label for="comprobante-importe-iva" class="col-sm-2  col-sm-offset-8 control-label">IVA {{iva*100}}%</label>
            <div class="col-sm-2">
              <input class="form-control ver-total" type="number" name="comprobante-importe-iva" id="comprobante-importe-iva" [ngModel]="verCompCCI.importe_iva" readonly>
            </div>
          </div>
          <div class="form-group row">
            <label for="comprobante-total" class="col-sm-2  col-sm-offset-8 control-label">Total</label>
            <div class="col-sm-2">
              <input class="form-control ver-total" type="number" name="comprobante-total" id="comprobante-total" [ngModel]="comprobante.importe_total" readonly>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" (click)="cerrar()" class="btn btn-default" data-dismiss="modal">Cerrar</button>
          <!--<button type="button" (click)="imprimirPDF(ctaCteClienteSeleccionada)" class="btn btn-primary">Imprimir</button >-->
        </div>
      </form>
    </div>
  </div>
</div>
